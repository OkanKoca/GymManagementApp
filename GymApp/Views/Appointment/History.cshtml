@model IEnumerable<GymApp.Models.Appointment>
@{
    ViewData["Title"] = "Geçmiþ Randevularým";
    // Türkiye saat dilimi
    var turkeyTimeZone = TimeZoneInfo.FindSystemTimeZoneById("Turkey Standard Time");
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="bi bi-clock-history"></i> Geçmiþ Randevularým</h2>
    <div>
        <a asp-action="Index" class="btn btn-outline-primary">
      <i class="bi bi-calendar-check"></i> Aktif Randevularým
        </a>
        <a asp-action="Create" class="btn btn-primary">
    <i class="bi bi-plus-circle"></i> Yeni Randevu
        </a>
    </div>
</div>

@if (!Model.Any())
{
    <div class="alert alert-info">
        <i class="bi bi-info-circle"></i> Henüz geçmiþ randevunuz bulunmamaktadýr.
    </div>
}
else
{
    <div class="row mb-3">
        <div class="col">
       <div class="card bg-light">
        <div class="card-body py-2">
     <div class="row text-center">
<div class="col-md-4">
       <span class="badge bg-info me-1">@Model.Count(a => a.Status == "Completed")</span>
        <small>Tamamlanan</small>
    </div>
    <div class="col-md-4">
            <span class="badge bg-secondary me-1">@Model.Count(a => a.Status == "Canceled")</span>
      <small>Ýptal Edilen</small>
    </div>
 <div class="col-md-4">
  <span class="badge bg-danger me-1">@Model.Count(a => a.Status == "Rejected")</span>
         <small>Reddedilen</small>
    </div>
     </div>
    </div>
       </div>
        </div>
    </div>

    <div class="table-responsive">
        <table class="table table-hover">
          <thead class="table-dark">
        <tr>
         <th>Tarih/Saat</th>
                <th>Eðitmen</th>
    <th>Hizmet</th>
         <th>Süre</th>
  <th>Ücret</th>
         <th>Durum</th>
           <th>Ýþlemler</th>
  </tr>
 </thead>
         <tbody>
      @foreach (var item in Model)
{
          var startTime = TimeZoneInfo.ConvertTimeFromUtc(item.StartAt, turkeyTimeZone);
   var endTime = TimeZoneInfo.ConvertTimeFromUtc(item.EndAt, turkeyTimeZone);
         var statusBadge = item.Status switch
       {
    "Completed" => "info",
               "Canceled" => "secondary",
     "Rejected" => "danger",
  _ => "secondary"
         };
        var statusText = item.Status switch
        {
  "Completed" => "Tamamlandý",
 "Canceled" => "Ýptal Edildi",
    "Rejected" => "Reddedildi",
_ => item.Status
        };
      var statusIcon = item.Status switch
          {
 "Completed" => "check-circle-fill",
         "Canceled" => "x-circle-fill",
        "Rejected" => "slash-circle-fill",
               _ => "circle"
           };
  <tr class="@(item.Status == "Completed" ? "" : "table-light text-muted")">
     <td>
  <strong>@startTime.ToString("dd.MM.yyyy")</strong><br />
         <small>@startTime.ToString("HH:mm") - @endTime.ToString("HH:mm")</small>
   </td>
      <td>@item.Trainer?.FullName</td>
        <td>@item.Service?.Name</td>
         <td>@item.Service?.DurationMinutes dk</td>
   <td>@item.Service?.Price.ToString("C")</td>
                <td>
                  <span class="badge bg-@statusBadge">
         <i class="bi bi-@statusIcon me-1"></i>@statusText
   </span>
            </td>
                   <td>
             <a asp-action="Details" asp-route-id="@item.Id" class="btn btn-sm btn-outline-info">
         <i class="bi bi-eye"></i> Detay
     </a>
       </td>
          </tr>
       }
     </tbody>
        </table>
    </div>

    <div class="mt-3">
        <p class="text-muted">
        <i class="bi bi-info-circle"></i> 
            Toplam <strong>@Model.Count()</strong> geçmiþ randevu bulunmaktadýr.
            Toplam harcama: <strong>@Model.Where(a => a.Status == "Completed").Sum(a => a.Service?.Price ?? 0).ToString("C")</strong>
    </p>
    </div>
}
